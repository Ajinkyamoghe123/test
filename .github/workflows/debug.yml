name: "Debug project move"

on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
      - name: Debug user projects + project page + issue
        env:
          GH_TOKEN: ${{ secrets.PROJECT_AUTOMATION_PAT }}
        run: |
          if [ -z "$GH_TOKEN" ]; then
            echo "ERROR: secret PROJECT_AUTOMATION_PAT is missing. Add it and re-run."
            exit 1
          fi

          echo "=== 1) List user projects (classic Projects REST API) ==="
          curl -i -s -H "Authorization: token $GH_TOKEN" -H "Accept: application/vnd.github.inertia-preview+json" "https://api.github.com/users/Ajinkyamoghe123/projects" | sed -n '1,200p'
          echo "---- end of projects list ----"

          echo ""
          echo "=== 2) Project page HTML (helps detect new Projects v2 banner) ==="
          curl -i -s -H "Authorization: token $GH_TOKEN" "https://github.com/users/Ajinkyamoghe123/projects/1" | sed -n '1,200p'
          echo "---- end of project page HTML ----"

          echo ""
          echo "=== 3) Issue JSON (check project membership) ==="
          curl -i -s -H "Authorization: token $GH_TOKEN" "https://api.github.com/repos/Ajinkyamoghe123/TATA/issues/1" | sed -n '1,200p'
          echo "---- end of issue JSON ----"

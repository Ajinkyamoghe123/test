name: "Move unfinished issues to the next sprint"

# Define when this automation should run.
on:
  schedule:
    # This CRON expression runs the action every 5 minutes (keeps the current setting).
    - cron: '*/5 * * * *'
  workflow_dispatch:

# Give the job explicit permissions that are valid.
permissions:
  contents: read
  issues: write

jobs:
  move_issues:
    runs-on: ubuntu-latest
    steps:
      - name: Check for PROJECT_AUTOMATION_PAT secret
        shell: bash
        run: |
          if [ -z "${{ secrets.PROJECT_AUTOMATION_PAT }}" ]; then
            echo ""
            echo "ERROR: Repository secret PROJECT_AUTOMATION_PAT is missing."
            echo ""
            echo "Create a Personal Access Token (PAT) with the 'repo' and 'projects' scopes and add it as a repository secret named PROJECT_AUTOMATION_PAT."
            echo ""
            echo "Steps:"
            echo "  1) Create a PAT: https://github.com/settings/tokens (choose 'repo' and 'projects' scopes)"
            echo "  2) Add it to this repository: Settings → Secrets and variables → Actions → New repository secret → Name: PROJECT_AUTOMATION_PAT"
            echo ""
            echo "After adding the secret, re-run this workflow."
            exit 1
          else
            echo "Found PROJECT_AUTOMATION_PAT secret. Continuing..."
          fi

      - name: Move items to next iteration
        uses: blombard/move-to-next-iteration@v0.6.1
        with:
          owner: 'Ajinkyamoghe123'
          # Project board number from your board URL: https://github.com/users/Ajinkyamoghe123/projects/1 → number: 1
          number: 1
          token: ${{ secrets.PROJECT_AUTOMATION_PAT }}
          # If your iteration field has a different exact name (capitalization/space-sensitive), update this value
          iteration-field: 'iteration'
          new-iteration: 'next'
          statuses: 'Open,In Progress'
